<!-- Universal Cyberpunk Navigation Component -->
<nav class="cyberpunk-navbar" id="cyberpunk-navbar">
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleMobileNav()" aria-label="Toggle Navigation">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
    </button>

    <!-- Navigation Brand -->
    <div class="nav-brand">
        <a href="{{ url_for('dashboard') if url_for else '/dashboard' }}" class="brand-link">
            <i class="fas fa-fingerprint brand-icon"></i>
            <span class="brand-text">Biometric Security</span>
        </a>
    </div>

    <!-- Main Navigation Menu -->
    <ul class="nav-menu" id="nav-menu">
        <!-- User Management Dropdown -->
        <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" onclick="toggleDropdown(event, 'users-dropdown')">
                <i class="fas fa-users"></i>
                <span class="nav-text">Users</span>
                <i class="fas fa-chevron-down dropdown-arrow"></i>
            </a>
            <ul class="dropdown-menu" id="users-dropdown">
                <li><a href="{{ url_for('register') if url_for else '/register' }}" class="dropdown-link">
                    <i class="fas fa-user-plus"></i> Register Suspect
                </a></li>
                <li><a href="{{ url_for('view_criminals') if url_for else '/view-criminals' }}" class="dropdown-link">
                    <i class="fas fa-list"></i> View Database
                </a></li>
                <li><a href="{{ url_for('profile') if url_for else '/profile' }}" class="dropdown-link">
                    <i class="fas fa-user-circle"></i> User Profile
                </a></li>
                {% if session.admin_role in ['admin', 'superadmin'] %}
                <li class="dropdown-divider"></li>
                <li><a href="{{ url_for('admin_management') if url_for else '/admin-management' }}" class="dropdown-link">
                    <i class="fas fa-user-shield"></i> Admin Management
                </a></li>
                {% endif %}
            </ul>
        </li>

        <!-- Biometric Operations Dropdown -->
        <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" onclick="toggleDropdown(event, 'biometrics-dropdown')">
                <i class="fas fa-search"></i>
                <span class="nav-text">Biometrics</span>
                <i class="fas fa-chevron-down dropdown-arrow"></i>
            </a>
            <ul class="dropdown-menu" id="biometrics-dropdown">
                <li><a href="{{ url_for('match_face_route') if url_for else '/match-form' }}" class="dropdown-link">
                    <i class="fas fa-user-check"></i> Face Matching
                </a></li>
                <li><a href="{{ url_for('match_fingerprint_route') if url_for else '/match-form-fingerprint' }}" class="dropdown-link">
                    <i class="fas fa-fingerprint"></i> Fingerprint Matching
                </a></li>
                <li><a href="{{ url_for('live_face_verification') if url_for else '/live-face-verification' }}" class="dropdown-link">
                    <i class="fas fa-camera"></i> Live Face Verification
                </a></li>
                <li><a href="{{ url_for('live_fingerprint_verification') if url_for else '/live-fingerprint-verification' }}" class="dropdown-link">
                    <i class="fas fa-hand-point-up"></i> Live Fingerprint
                </a></li>
                <li><a href="{{ url_for('fingerprint_match_options') if url_for else '/fingerprint-match-options' }}" class="dropdown-link">
                    <i class="fas fa-hand-paper"></i> Fingerprint Options
                </a></li>
            </ul>
        </li>

        <!-- Data & Reports Dropdown -->
        <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" onclick="toggleDropdown(event, 'data-dropdown')">
                <i class="fas fa-database"></i>
                <span class="nav-text">Data</span>
                <i class="fas fa-chevron-down dropdown-arrow"></i>
            </a>
            <ul class="dropdown-menu" id="data-dropdown">
                <li><a href="{{ url_for('view_criminals') if url_for else '/view-criminals' }}" class="dropdown-link">
                    <i class="fas fa-list"></i> Criminal Database
                </a></li>
                <li><a href="{{ url_for('reports') if url_for else '/reports' }}" class="dropdown-link">
                    <i class="fas fa-chart-bar"></i> Generate Reports
                </a></li>
                <li><a href="{{ url_for('match_result') if url_for else '/match-result' }}" class="dropdown-link">
                    <i class="fas fa-search-plus"></i> Match Results
                </a></li>
            </ul>
        </li>

        <!-- Security & Admin Dropdown (Admin/Superadmin only) -->
        {% if session.admin_role in ['admin', 'superadmin'] %}
        <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" onclick="toggleDropdown(event, 'security-dropdown')">
                <i class="fas fa-shield-alt"></i>
                <span class="nav-text">Security</span>
                <i class="fas fa-chevron-down dropdown-arrow"></i>
            </a>
            <ul class="dropdown-menu" id="security-dropdown">
                <li><a href="{{ url_for('cybersecurity_dashboard') if url_for else '/cybersecurity-dashboard' }}" class="dropdown-link">
                    <i class="fas fa-lock"></i> Security Dashboard
                </a></li>
                <li><a href="{{ url_for('admin_dashboard') if url_for else '/admin-dashboard-old' }}" class="dropdown-link">
                    <i class="fas fa-desktop"></i> Admin Dashboard
                </a></li>
                {% if session.admin_role == 'superadmin' %}
                <li class="dropdown-divider"></li>
                <li><a href="{{ url_for('edit_admin') if url_for else '/edit-admin' }}" class="dropdown-link">
                    <i class="fas fa-user-edit"></i> Edit Admin
                </a></li>
                {% endif %}
            </ul>
        </li>
        {% endif %}

        <!-- System Dropdown -->
        <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" onclick="toggleDropdown(event, 'system-dropdown')">
                <i class="fas fa-cog"></i>
                <span class="nav-text">System</span>
                <i class="fas fa-chevron-down dropdown-arrow"></i>
            </a>
            <ul class="dropdown-menu" id="system-dropdown">
                <li><a href="{{ url_for('original_home') if url_for else '/original' }}" class="dropdown-link">
                    <i class="fas fa-home"></i> Original Homepage
                </a></li>
                <li><a href="{{ url_for('api_status') if url_for else '/api' }}" class="dropdown-link">
                    <i class="fas fa-code"></i> API Status
                </a></li>
                <li><a href="{{ url_for('feature_unavailable') if url_for else '/feature-unavailable' }}" class="dropdown-link">
                    <i class="fas fa-exclamation-triangle"></i> Feature Status
                </a></li>
            </ul>
        </li>
    </ul>

    <!-- User Info & Actions -->
    <div class="nav-user">
        <!-- Search Button -->
        <button class="nav-search-btn" onclick="toggleSearch()" title="Search">
            <i class="fas fa-search"></i>
        </button>

        <!-- User Info Dropdown -->
        <div class="user-dropdown">
            <button class="user-info-btn" onclick="toggleDropdown(event, 'user-info-dropdown')">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-details">
                    <span class="user-name">{{ session.admin_username or 'User' }}</span>
                    <span class="user-role">{{ (session.admin_role or 'user').title() }}</span>
                </div>
                <i class="fas fa-chevron-down"></i>
            </button>
            <ul class="dropdown-menu user-menu" id="user-info-dropdown">
                <li><a href="{{ url_for('profile') if url_for else '/profile' }}" class="dropdown-link">
                    <i class="fas fa-user-circle"></i> Profile
                </a></li>
                <li><a href="{{ url_for('dashboard') if url_for else '/dashboard' }}" class="dropdown-link">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a></li>
                <li class="dropdown-divider"></li>
                <li><a href="{{ url_for('logout') if url_for else '/logout' }}" class="dropdown-link logout-link">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a></li>
            </ul>
        </div>
    </div>

    <!-- Search Overlay -->
    <div class="search-overlay" id="search-overlay">
        <div class="search-container">
            <input type="text" class="search-input" placeholder="Search criminals, cases, or features..." id="nav-search-input">
            <button class="search-submit" onclick="performSearch()">
                <i class="fas fa-search"></i>
            </button>
            <button class="search-close" onclick="toggleSearch()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="search-results" id="search-results">
            <!-- Search results will be populated here -->
        </div>
    </div>
</nav>

<!-- Breadcrumb Navigation -->
<nav class="breadcrumb-nav" id="breadcrumb-nav">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="{{ url_for('dashboard') if url_for else '/dashboard' }}">
                <i class="fas fa-home"></i> Dashboard
            </a>
        </li>
        <!-- Dynamic breadcrumb items will be added here -->
    </ol>
</nav>

<!-- Mobile Navigation Backdrop -->
<div class="mobile-nav-backdrop" id="mobile-nav-backdrop" onclick="closeMobileNav()"></div>

<style>
/* Universal Cyberpunk Navigation Styles */
.cyberpunk-navbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background: var(--bg-card);
    border-bottom: 1px solid rgba(76, 201, 240, 0.3);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: var(--glow-cyan);
    display: flex;
    align-items: center;
    padding: 0 1rem;
    height: 70px;
    transition: all var(--transition-normal);
}

/* Navigation Brand */
.nav-brand {
    display: flex;
    align-items: center;
    margin-right: 2rem;
}

.brand-link {
    display: flex;
    align-items: center;
    text-decoration: none;
    color: var(--primary-light);
    font-weight: 700;
    font-size: 1.2rem;
    transition: all var(--transition-fast);
}

.brand-link:hover {
    color: var(--accent-cyan);
    text-shadow: var(--glow-cyan);
}

.brand-icon {
    font-size: 1.5rem;
    margin-right: 0.5rem;
    animation: pulse 2s infinite;
}

.brand-text {
    font-family: 'Orbitron', sans-serif;
}

/* Main Navigation Menu */
.nav-menu {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    flex: 1;
}

.nav-item {
    position: relative;
    margin-right: 1rem;
}

.nav-link {
    display: flex;
    align-items: center;
    padding: 0.75rem 1rem;
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: 8px;
    transition: all var(--transition-fast);
    position: relative;
    overflow: hidden;
}

.nav-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(76, 201, 240, 0.1), transparent);
    transition: left var(--transition-normal);
}

.nav-link:hover::before {
    left: 100%;
}

.nav-link:hover {
    color: var(--primary-light);
    background: var(--bg-glass);
    box-shadow: var(--glow-cyan);
    transform: translateY(-2px);
}

.nav-link i {
    margin-right: 0.5rem;
    font-size: 1rem;
}

.nav-text {
    margin-right: 0.5rem;
}

.dropdown-arrow {
    font-size: 0.8rem;
    transition: transform var(--transition-fast);
}

.dropdown.active .dropdown-arrow {
    transform: rotate(180deg);
}

/* Dropdown Menus */
.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    background: var(--bg-card);
    border: 1px solid rgba(76, 201, 240, 0.3);
    border-radius: 8px;
    box-shadow: var(--glow-cyan);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    min-width: 200px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all var(--transition-fast);
    z-index: 1001;
    list-style: none;
    margin: 0;
    padding: 0.5rem 0;
}

.dropdown.active .dropdown-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.dropdown-link {
    display: flex;
    align-items: center;
    padding: 0.75rem 1rem;
    color: var(--text-secondary);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.dropdown-link:hover {
    color: var(--primary-light);
    background: var(--bg-glass);
    transform: translateX(5px);
}

.dropdown-link i {
    margin-right: 0.75rem;
    width: 16px;
    text-align: center;
}

.dropdown-divider {
    height: 1px;
    background: rgba(76, 201, 240, 0.2);
    margin: 0.5rem 0;
}

/* User Section */
.nav-user {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.nav-search-btn {
    background: none;
    border: 1px solid rgba(76, 201, 240, 0.3);
    color: var(--text-secondary);
    padding: 0.5rem;
    border-radius: 50%;
    cursor: pointer;
    transition: all var(--transition-fast);
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.nav-search-btn:hover {
    color: var(--primary-light);
    border-color: var(--primary-light);
    box-shadow: var(--glow-cyan);
}

.user-dropdown {
    position: relative;
}

.user-info-btn {
    display: flex;
    align-items: center;
    background: none;
    border: 1px solid rgba(76, 201, 240, 0.3);
    color: var(--text-primary);
    padding: 0.5rem 1rem;
    border-radius: 25px;
    cursor: pointer;
    transition: all var(--transition-fast);
    gap: 0.75rem;
}

.user-info-btn:hover {
    border-color: var(--primary-light);
    box-shadow: var(--glow-cyan);
}

.user-avatar i {
    font-size: 1.5rem;
    color: var(--primary-light);
}

.user-details {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.user-name {
    font-weight: 600;
    font-size: 0.9rem;
}

.user-role {
    font-size: 0.75rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.user-menu {
    right: 0;
    left: auto;
}

.logout-link {
    color: var(--accent-red) !important;
}

.logout-link:hover {
    background: rgba(255, 107, 107, 0.1) !important;
}

/* Search Overlay */
.search-overlay {
    position: fixed;
    top: 70px;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(10, 14, 23, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    z-index: 999;
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-normal);
}

.search-overlay.active {
    opacity: 1;
    visibility: visible;
}

.search-container {
    display: flex;
    align-items: center;
    max-width: 600px;
    margin: 2rem auto;
    padding: 0 2rem;
    gap: 1rem;
}

.search-input {
    flex: 1;
    padding: 1rem 1.5rem;
    background: var(--bg-card);
    border: 1px solid rgba(76, 201, 240, 0.3);
    border-radius: 25px;
    color: var(--text-primary);
    font-size: 1.1rem;
    outline: none;
    transition: all var(--transition-fast);
}

.search-input:focus {
    border-color: var(--primary-light);
    box-shadow: var(--glow-cyan);
}

.search-submit,
.search-close {
    background: var(--primary-gradient);
    border: none;
    color: var(--text-primary);
    padding: 1rem;
    border-radius: 50%;
    cursor: pointer;
    transition: all var(--transition-fast);
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.search-submit:hover,
.search-close:hover {
    box-shadow: var(--glow-cyan);
    transform: scale(1.1);
}

.search-results {
    max-width: 600px;
    margin: 0 auto;
    padding: 0 2rem;
}

/* Breadcrumb Navigation */
.breadcrumb-nav {
    position: fixed;
    top: 70px;
    left: 0;
    right: 0;
    background: rgba(16, 24, 38, 0.9);
    border-bottom: 1px solid rgba(76, 201, 240, 0.2);
    padding: 0.5rem 1rem;
    z-index: 998;
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
}

.breadcrumb {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    align-items: center;
}

.breadcrumb-item {
    display: flex;
    align-items: center;
}

.breadcrumb-item:not(:last-child)::after {
    content: '>';
    margin: 0 0.5rem;
    color: var(--text-muted);
}

.breadcrumb-item a {
    color: var(--text-secondary);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumb-item a:hover {
    color: var(--primary-light);
}

.breadcrumb-item.active {
    color: var(--primary-light);
}

/* Mobile Styles */
.mobile-menu-toggle {
    display: none;
    background: none;
    border: none;
    color: var(--text-primary);
    cursor: pointer;
    flex-direction: column;
    gap: 4px;
    padding: 0.5rem;
    margin-right: 1rem;
}

.hamburger-line {
    width: 25px;
    height: 3px;
    background: var(--primary-light);
    transition: all var(--transition-fast);
    border-radius: 2px;
}

.mobile-nav-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 998;
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-fast);
}

.mobile-nav-backdrop.active {
    opacity: 1;
    visibility: visible;
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .mobile-menu-toggle {
        display: flex;
    }

    .nav-menu {
        position: fixed;
        top: 70px;
        left: -100%;
        width: 280px;
        height: calc(100vh - 70px);
        background: var(--bg-card);
        flex-direction: column;
        padding: 1rem 0;
        transition: left var(--transition-normal);
        overflow-y: auto;
        border-right: 1px solid rgba(76, 201, 240, 0.3);
    }

    .nav-menu.active {
        left: 0;
    }

    .nav-item {
        margin: 0;
        width: 100%;
    }

    .nav-link {
        padding: 1rem 1.5rem;
        border-radius: 0;
    }

    .dropdown-menu {
        position: static;
        opacity: 1;
        visibility: visible;
        transform: none;
        box-shadow: none;
        border: none;
        background: rgba(76, 201, 240, 0.05);
        margin-left: 1rem;
        max-height: 0;
        overflow: hidden;
        transition: max-height var(--transition-normal);
    }

    .dropdown.active .dropdown-menu {
        max-height: 300px;
    }

    .user-details {
        display: none;
    }

    .nav-text {
        display: none;
    }

    .breadcrumb-nav {
        display: none;
    }
}

@media (max-width: 480px) {
    .cyberpunk-navbar {
        padding: 0 0.5rem;
    }

    .brand-text {
        display: none;
    }

    .nav-search-btn {
        display: none;
    }
}

/* Animation for mobile menu toggle */
.mobile-menu-toggle.active .hamburger-line:nth-child(1) {
    transform: rotate(45deg) translate(6px, 6px);
}

.mobile-menu-toggle.active .hamburger-line:nth-child(2) {
    opacity: 0;
}

.mobile-menu-toggle.active .hamburger-line:nth-child(3) {
    transform: rotate(-45deg) translate(6px, -6px);
}
</style>

<script>
// Universal Navigation JavaScript
(function() {
    'use strict';

    // Navigation state
    let activeDropdown = null;
    let isMobileMenuOpen = false;
    let isSearchOpen = false;

    // Toggle dropdown menus
    window.toggleDropdown = function(event, dropdownId) {
        event.preventDefault();
        event.stopPropagation();

        const dropdown = document.getElementById(dropdownId);
        const navItem = dropdown.closest('.nav-item, .user-dropdown');

        // Close other dropdowns
        if (activeDropdown && activeDropdown !== navItem) {
            activeDropdown.classList.remove('active');
        }

        // Toggle current dropdown
        navItem.classList.toggle('active');
        activeDropdown = navItem.classList.contains('active') ? navItem : null;
    };

    // Toggle mobile navigation
    window.toggleMobileNav = function() {
        const navMenu = document.getElementById('nav-menu');
        const backdrop = document.getElementById('mobile-nav-backdrop');
        const toggle = document.querySelector('.mobile-menu-toggle');

        isMobileMenuOpen = !isMobileMenuOpen;

        navMenu.classList.toggle('active', isMobileMenuOpen);
        backdrop.classList.toggle('active', isMobileMenuOpen);
        toggle.classList.toggle('active', isMobileMenuOpen);

        // Prevent body scroll when menu is open
        document.body.style.overflow = isMobileMenuOpen ? 'hidden' : '';
    };

    // Close mobile navigation
    window.closeMobileNav = function() {
        if (isMobileMenuOpen) {
            toggleMobileNav();
        }
    };

    // Toggle search overlay
    window.toggleSearch = function() {
        const searchOverlay = document.getElementById('search-overlay');
        const searchInput = document.getElementById('nav-search-input');

        isSearchOpen = !isSearchOpen;
        searchOverlay.classList.toggle('active', isSearchOpen);

        if (isSearchOpen) {
            setTimeout(() => searchInput.focus(), 100);
        }
    };

    // Perform search
    window.performSearch = function() {
        const searchInput = document.getElementById('nav-search-input');
        const query = searchInput.value.trim();

        if (query) {
            // Implement search functionality here
            console.log('Searching for:', query);
            // You can redirect to search results page or show results in overlay
            window.location.href = `/search?q=${encodeURIComponent(query)}`;
        }
    };

    // Update breadcrumb navigation
    window.updateBreadcrumb = function(items) {
        const breadcrumb = document.querySelector('.breadcrumb');
        if (!breadcrumb) return;

        // Keep the home item
        const homeItem = breadcrumb.querySelector('.breadcrumb-item');
        breadcrumb.innerHTML = '';
        breadcrumb.appendChild(homeItem);

        // Add new items
        items.forEach((item, index) => {
            const li = document.createElement('li');
            li.className = 'breadcrumb-item';
            
            if (index === items.length - 1) {
                li.className += ' active';
                li.textContent = item.text;
            } else {
                const a = document.createElement('a');
                a.href = item.url;
                a.textContent = item.text;
                li.appendChild(a);
            }
            
            breadcrumb.appendChild(li);
        });
    };

    // Close dropdowns when clicking outside
    document.addEventListener('click', function(event) {
        if (activeDropdown && !activeDropdown.contains(event.target)) {
            activeDropdown.classList.remove('active');
            activeDropdown = null;
        }
    });

    // Handle escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            if (isSearchOpen) {
                toggleSearch();
            } else if (isMobileMenuOpen) {
                closeMobileNav();
            } else if (activeDropdown) {
                activeDropdown.classList.remove('active');
                activeDropdown = null;
            }
        }
    });

    // Handle search input enter key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Enter' && event.target.id === 'nav-search-input') {
            performSearch();
        }
    });

    // Auto-close mobile menu on window resize
    window.addEventListener('resize', function() {
        if (window.innerWidth > 768 && isMobileMenuOpen) {
            closeMobileNav();
        }
    });

    // Initialize navigation
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ðŸ§­ Universal Cyberpunk Navigation Initialized');
        
        // Set active navigation item based on current page
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('.nav-link, .dropdown-link');
        
        navLinks.forEach(link => {
            if (link.getAttribute('href') === currentPath) {
                link.classList.add('active');
                // If it's a dropdown link, also mark the parent as active
                const parentDropdown = link.closest('.dropdown');
                if (parentDropdown) {
                    parentDropdown.querySelector('.nav-link').classList.add('active');
                }
            }
        });
    });

})();
</script>